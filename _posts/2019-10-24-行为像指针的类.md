---
layout:     post
title:      行为像指针的类     
subtitle:   类、指针 
date:       2019-10-24
author:     Huw
header-img: img/post-bg-kuaidi.jpg
catalog: true
tags:
    - C++

---
```
#include <string>

class HasPtr {
public:
	HasPtr(const std::string& s = std::string()) : ps(new std::string(s)), i(0), use(new size_t(1)) { }   //初始化时，对象的引用计数为1
	HasPtr(const HasPtr& hp) : ps(hp.ps), i(hp.i), use(hp.use) { ++* use; }
	HasPtr& operator=(const HasPtr& rhs) {
		++* rhs.use;      
		if (-- * use == 0) {
			delete ps;
			delete use;
		}
		ps = rhs.ps;
		i = rhs.i;
		use = rhs.use;
		return *this;
	}
	~HasPtr() {
		if (-- * use == 0) {
			delete ps;
			delete use;
		}
	}
private:
	std::string* ps;
	int i;
	size_t* use;
};

int main()
{
	HasPtr a;
	a = a;       //如果是自赋值 ，不会进if语句 ，use的引用计数最终会不变
	HasPtr b;  
	b = a;   //正常赋值 use的引用计数加1   b.use和a.use指向同一对象
}
```
